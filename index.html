<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Signup</title>
    <!-- Google Identity Services (GIS) Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .form-container {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            backface-visibility: hidden; /* Prevents flickering during transition */
        }
        .form-hidden {
            opacity: 0;
            transform: scale(0.98);
            pointer-events: none;
            position: absolute;
            width: 100%;
        }
        .split-bg {
            background: linear-gradient(to right, #6366f1, #818cf8);
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="min-h-screen flex items-center justify-center">
        <div class="flex flex-col md:flex-row w-full max-w-4xl bg-white rounded-2xl shadow-2xl overflow-hidden m-4">
            <!-- Left Side (Branding/Image) -->
            <div class="w-full md:w-1/2 p-12 flex flex-col justify-center items-center text-white split-bg">
                <h1 class="text-4xl font-bold mb-4">Big4India</h1>
                <p class="text-center text-indigo-100">Welcome to our platform. Securely log in or create an account to get started.</p>
                 <!-- You can add an SVG or image here -->
                 <svg class="w-48 h-48 mt-8 text-indigo-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"></path></svg>
            </div>

            <!-- Right Side (Form) -->
            <div class="w-full md:w-1/2 p-8 md:p-12 relative">
                <!-- Message Box -->
                <div id="messageBox" class="hidden absolute top-4 right-4 bg-green-500 text-white text-sm font-medium px-4 py-2 rounded-lg shadow-md transition-transform duration-300 z-20">
                    <p id="messageText"></p>
                </div>

                <!-- Auth Container: Holds all forms -->
                <div id="authContainer" class="relative min-h-[450px]">
                    <!-- Login Form -->
                    <div id="loginForm" class="form-container">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Login</h2>
                        <p class="text-gray-500 mb-8">Access your account.</p>
                        
                        <form id="login" onsubmit="handleLogin(event)">
                            <div class="mb-4">
                                <label for="loginEmail" class="block text-gray-700 text-sm font-medium mb-2">Email Address</label>
                                <input type="email" id="loginEmail" name="email" class="w-full px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="you@example.com" required>
                            </div>
                            <div class="mb-6">
                                <label for="loginPassword" class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="loginPassword" name="password" class="w-full px-4 py-3 pr-10 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="••••••••" required>
                                    <button type="button" id="toggleLoginPasswordBtn" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700">
                                        <svg id="eye-open-login" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5s-8.573-3.007-9.963-7.178z" />
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        <svg id="eye-closed-login" class="h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243l-4.243-4.243" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-300 transform hover:scale-105">Log In</button>
                        </form>
                        
                        <div class="my-6 flex items-center">
                            <hr class="w-full border-gray-300">
                            <span class="px-2 text-sm text-gray-500 bg-white">OR</span>
                            <hr class="w-full border-gray-300">
                        </div>
                        
                        <!-- Google Sign-In Button Container -->
                        <div id="google_btn_login" class="flex justify-center"></div>

                        <p class="text-center text-sm text-gray-600 mt-8">
                            Don't have an account? 
                            <button onclick="toggleForms()" class="font-medium text-indigo-600 hover:underline">Sign up</button>
                        </p>
                    </div>

                    <!-- Signup Form -->
                    <div id="signupForm" class="form-container form-hidden">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Create Account</h2>
                        <p class="text-gray-500 mb-8">Get started with a new account.</p>
                        
                        <form id="signup" onsubmit="handleSignup(event)">
                            <div class="mb-4">
                                <label for="signupName" class="block text-gray-700 text-sm font-medium mb-2">Full Name</label>
                                <input type="text" id="signupName" name="name" class="w-full px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="John Doe" required>
                            </div>
                            <div class="mb-4">
                                <label for="signupEmail" class="block text-gray-700 text-sm font-medium mb-2">Email Address</label>
                                <input type="email" id="signupEmail" name="email" class="w-full px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="you@example.com" required>
                            </div>
                            <div class="mb-6">
                                <label for="signupPassword" class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="signupPassword" name="password" class="w-full px-4 py-3 pr-10 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="Minimum 6 characters" required>
                                     <button type="button" id="toggleSignupPasswordBtn" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700">
                                        <svg id="eye-open-signup" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5s-8.573-3.007-9.963-7.178z" />
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        <svg id="eye-closed-signup" class="h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243l-4.243-4.243" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-300 transform hover:scale-105">Create Account</button>
                        </form>
                        
                        <div class="my-6 flex items-center">
                            <hr class="w-full border-gray-300">
                            <span class="px-2 text-sm text-gray-500 bg-white">OR</span>
                            <hr class="w-full border-gray-300">
                        </div>

                        <!-- Google Sign-Up Button Container -->
                        <div id="google_btn_signup" class="flex justify-center"></div>

                        <p class="text-center text-sm text-gray-600 mt-8">
                            Already have an account? 
                            <button onclick="toggleForms()" class="font-medium text-indigo-600 hover:underline">Log in</button>
                        </p>
                    </div>
                </div>

                <!-- Logged In Container -->
                <div id="loggedInContainer" class="hidden text-center flex flex-col justify-center h-full">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Welcome!</h2>
                    <p id="welcomeMessage" class="text-gray-600 mb-8"></p>
                    <button onclick="handleLogout()" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-300 transform hover:scale-105">Log Out</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            updateProfile,
            signOut,
            GoogleAuthProvider,
            signInWithCredential // New import
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAaJxnKWkXUPlzc0w6aUuAxT72RBPs5gcw",
          authDomain: "big4india-75b92.firebaseapp.com",
          projectId: "big4india-75b92",
          storageBucket: "big4india-75b92.appspot.com",
          messagingSenderId: "635435989681",
          appId: "1:635435989681:web:8321bbfae15b6084d18090",
          measurementId: "G-2VB1BRVLKP"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const loginFormEl = document.getElementById('loginForm');
        const signupFormEl = document.getElementById('signupForm');
        const authContainer = document.getElementById('authContainer');
        const loggedInContainer = document.getElementById('loggedInContainer');

        const dom = {
            messageBox: document.getElementById('messageBox'),
            messageText: document.getElementById('messageText'),
            welcomeMessage: document.getElementById('welcomeMessage')
        };
        
        // --- GOOGLE IDENTITY SERVICES (GIS) SETUP ---
        // This function is called by the Google GIS library after a user signs in.
        function handleGoogleCredentialResponse(response) {
            console.log("Received Google credential response:", response);
            // Get the ID token from Google's response.
            const idToken = response.credential;

            // Create a Firebase credential with the Google ID token.
            const credential = GoogleAuthProvider.credential(idToken);

            // Sign in to Firebase with the credential.
            signInWithCredential(auth, credential)
                .then((result) => {
                    const user = result.user;
                    showMessage(`Welcome, ${user.displayName}! Redirecting...`);
                    // onAuthStateChanged will handle the UI update and redirect.
                })
                .catch((error) => {
                    console.error("Firebase signInWithCredential error:", error);
                    showMessage(getFriendlyErrorMessage(error.code), true);
                });
        }
        
        // Expose the function to the global scope so the GIS library can call it.
        window.handleGoogleCredentialResponse = handleGoogleCredentialResponse;
        
        // This function runs when the entire page is loaded.
        window.onload = function () {
          try {
              google.accounts.id.initialize({
                // Your Google Cloud Client ID
                client_id: "635435989681-s7hg9fl9d2s310ktet6qf7u4q9c34325.apps.googleusercontent.com",
                // The name of the function to call after sign-in
                callback: handleGoogleCredentialResponse
              });

              // Render the Google Sign-In button in the login form
              google.accounts.id.renderButton(
                document.getElementById("google_btn_login"),
                { theme: "outline", size: "large", width: "300", text: "signin_with" } 
              );

              // Render the Google Sign-In button in the signup form
              google.accounts.id.renderButton(
                document.getElementById("google_btn_signup"),
                { theme: "outline", size: "large", width: "300", text: "signup_with" } 
              );
          } catch (error) {
              console.error("Google Identity Services initialization failed:", error);
              showMessage("Could not load Google Sign-In.", true);
          }
        };

        // --- AUTH STATE OBSERVER ---
        onAuthStateChanged(auth, user => {
            if (user) {
                authContainer.classList.add('hidden');
                loggedInContainer.classList.remove('hidden');
                let displayName = user.displayName || user.email;
                dom.welcomeMessage.textContent = `You are logged in as ${displayName}`;
                 // Check if we should redirect
                if (window.location.pathname.endsWith('auth.html')) {
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 500); // Short delay to show login status before redirect
                }
            } else {
                authContainer.classList.remove('hidden');
                loggedInContainer.classList.add('hidden');
                loginFormEl.classList.remove('form-hidden');
                signupFormEl.classList.add('form-hidden');
            }
        });

        // --- PASSWORD VISIBILITY TOGGLE ---
        function setupPasswordToggle(inputId, buttonId, eyeOpenId, eyeClosedId) {
            const passwordInput = document.getElementById(inputId);
            const toggleButton = document.getElementById(buttonId);
            const eyeOpen = document.getElementById(eyeOpenId);
            const eyeClosed = document.getElementById(eyeClosedId);

            if (toggleButton) {
                toggleButton.addEventListener('click', function() {
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        eyeOpen.classList.add('hidden');
                        eyeClosed.classList.remove('hidden');
                    } else {
                        passwordInput.type = 'password';
                        eyeOpen.classList.remove('hidden');
                        eyeClosed.classList.add('hidden');
                    }
                });
            }
        }

        setupPasswordToggle('loginPassword', 'toggleLoginPasswordBtn', 'eye-open-login', 'eye-closed-login');
        setupPasswordToggle('signupPassword', 'toggleSignupPasswordBtn', 'eye-open-signup', 'eye-closed-signup');

        // --- UI FUNCTIONS ---
        window.toggleForms = function() {
            loginFormEl.classList.toggle('form-hidden');
            signupFormEl.classList.toggle('form-hidden');
        };

        function showMessage(message, isError = false) {
            dom.messageText.textContent = message;
            dom.messageBox.classList.remove('hidden', 'bg-green-500', 'bg-red-500');
            dom.messageBox.classList.add(isError ? 'bg-red-500' : 'bg-green-500');
            
            dom.messageBox.style.transform = 'translateY(0)';
            dom.messageBox.style.opacity = '1';

            setTimeout(() => {
                 dom.messageBox.style.transform = 'translateY(-20px)';
                 dom.messageBox.style.opacity = '0';
                 setTimeout(()=> dom.messageBox.classList.add('hidden'), 300)
            }, 3000);
        }

        // --- AUTH HANDLERS ---
        window.handleLogin = function(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) return showMessage('Please fill in all fields.', true);

            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    showMessage('Logged in successfully! Redirecting...');
                    document.getElementById('login').reset();
                })
                .catch(error => showMessage(getFriendlyErrorMessage(error.code), true));
        };

        window.handleSignup = function(event) {
            event.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !password) return showMessage('Please fill in all fields.', true);
            if (password.length < 6) return showMessage('Password must be at least 6 characters long.', true);

            createUserWithEmailAndPassword(auth, email, password)
                .then(userCredential => updateProfile(userCredential.user, { displayName: name }))
                .then(() => {
                    showMessage('Account created successfully! Redirecting...');
                     document.getElementById('signup').reset();
                })
                .catch(error => showMessage(getFriendlyErrorMessage(error.code), true));
        };
        
        function getFriendlyErrorMessage(errorCode) {
            switch (errorCode) {
                case 'auth/invalid-email':
                    return 'Please enter a valid email address.';
                case 'auth/user-not-found':
                     return 'No account found with this email. Please sign up.';
                case 'auth/wrong-password':
                     return 'Incorrect password. Please try again.';
                case 'auth/email-already-in-use':
                    return 'An account with this email already exists.';
                case 'auth/weak-password':
                    return 'Password is too weak. Please choose a stronger one.';
                case 'auth/account-exists-with-different-credential':
                    return 'An account already exists with this email using a different sign-in method.';
                case 'auth/popup-closed-by-user':
                        return 'Sign-in window was closed. Please try again.';
                case 'auth/popup-blocked-by-browser':
                        return 'Pop-up was blocked. Please allow pop-ups for this site.';
                default:
                    console.log("Unhandled auth error:", errorCode);
                    return 'An unexpected error occurred. Please try again.';
            }
        }

        window.handleLogout = function() {
            signOut(auth).then(() => {
                showMessage('You have been logged out.');
            }).catch((error) => {
                showMessage('Error logging out. Please try again.', true);
            });
        };
    </script>
</body>
</html>

